# üîß LANGFLIX TROUBLESHOOTING GUIDE
## Common Issues & Solutions

**Generated by:** Agent 1 Infrastructure Engineer  
**Last Updated:** October 17, 2025

---

## üö® CRITICAL ISSUES

### Server Won't Start

#### Issue: Port Already in Use
```
Error: listen EADDRINUSE: address already in use 0.0.0.0:3001
```

**Solution:**
```bash
# Kill process using port 3001
lsof -ti:3001 | xargs kill -9

# Or use different port
PORT=3002 npm run start:server
```

#### Issue: Missing Environment Variables
```
Error: Environment variable not found: OPENAI_API_KEY
```

**Solution:**
```bash
# Check environment setup
npm run setup:check

# Verify .env file exists and has required variables
cat .env | grep OPENAI_API_KEY

# Add missing variables to .env file
echo 'OPENAI_API_KEY="sk-proj-your-key-here"' >> .env
```

#### Issue: Database Connection Failed
```
Error: Can't reach database server at localhost:5432
```

**Solution:**
```bash
# Check database URL format
echo $DATABASE_URL

# For SQLite (local development):
DATABASE_URL="file:./dev.db"

# For PostgreSQL (production):
DATABASE_URL="postgresql://user:pass@host/db?sslmode=require"

# Test connection
npx prisma db push
```

---

## üóÑÔ∏è DATABASE ISSUES

### Prisma Schema Errors

#### Issue: Duplicate Model Definition
```
Error: The model "ReviewSession" cannot be defined because a model with that name already exists.
```

**Solution:**
```bash
# Check for duplicate models
grep -n "model ReviewSession" prisma/schema.prisma

# Remove duplicate model (keep the first one)
# Edit prisma/schema.prisma and remove duplicate

# Regenerate Prisma client
npx prisma generate
```

#### Issue: Migration Failed
```
Error: P1001 Can't reach database server
```

**Solution:**
```bash
# Check database URL
echo $DATABASE_URL

# For Neon PostgreSQL, ensure URL includes SSL:
DATABASE_URL="postgresql://user:pass@host/db?sslmode=require"

# Reset and push schema
npx prisma db push --force-reset
```

#### Issue: Database Schema Out of Sync
```
Error: The database schema is not in sync with the Prisma schema
```

**Solution:**
```bash
# Sync database with schema
npx prisma db push

# Or create migration
npx prisma migrate dev --name sync-schema
```

---

## üîê AUTHENTICATION ISSUES

### Supabase Configuration

#### Issue: Supabase Credentials Not Found
```
Warning: Supabase credentials not found in environment variables
```

**Solution:**
```bash
# Add Supabase credentials to .env
echo 'SUPABASE_URL="https://your-project.supabase.co"' >> .env
echo 'SUPABASE_ANON_KEY="your-anon-key"' >> .env
echo 'SUPABASE_SERVICE_ROLE_KEY="your-service-role-key"' >> .env

# Restart server
npm run start:server
```

#### Issue: JWT Token Invalid
```
Error: Invalid JWT token
```

**Solution:**
```bash
# Check JWT secret
echo $JWT_SECRET

# Generate new JWT secret
node -e "console.log(require('crypto').randomBytes(32).toString('base64'))"

# Update .env with new secret
echo 'JWT_SECRET="new-secret-here"' >> .env
```

---

## ü§ñ AI SERVICE ISSUES

### OpenAI API Problems

#### Issue: OpenAI API Key Invalid
```
Error: Invalid API key provided
```

**Solution:**
```bash
# Verify API key format
echo $OPENAI_API_KEY

# API key should start with 'sk-proj-'
# Get new key from https://platform.openai.com/api-keys

# Update .env
echo 'OPENAI_API_KEY="sk-proj-your-new-key"' >> .env
```

#### Issue: OpenAI Rate Limit
```
Error: Rate limit exceeded
```

**Solution:**
```bash
# Check API usage at https://platform.openai.com/usage
# Add more credits or wait for rate limit reset
# Implement exponential backoff in code
```

### Translation Service Issues

#### Issue: LibreTranslate API Down
```
Error: Connection timeout to LibreTranslate
```

**Solution:**
```bash
# Check if service is up
curl https://libretranslate.com/translate

# Update API URL in .env
echo 'LIBRETRANSLATE_API_URL="https://libretranslate.com/translate"' >> .env

# Consider using backup translation service (Google Translate)
```

---

## üöÄ DEPLOYMENT ISSUES

### Vercel Deployment Problems

#### Issue: Build Failed on Vercel
```
Error: Build failed during deployment
```

**Solution:**
```bash
# Check build logs in Vercel dashboard
# Common issues:
# 1. Missing environment variables
# 2. Node.js version mismatch
# 3. Build script errors

# Verify build locally
npm run build

# Check package.json scripts
cat package.json | grep -A 10 '"scripts"'
```

#### Issue: Environment Variables Not Set in Production
```
Error: Environment variable not found in production
```

**Solution:**
1. Go to Vercel Dashboard ‚Üí Project ‚Üí Settings ‚Üí Environment Variables
2. Add all required variables from .env file
3. Redeploy application

### CI/CD Pipeline Issues

#### Issue: GitHub Actions Failed
```
Error: CI/CD pipeline failed
```

**Solution:**
```bash
# Check GitHub Actions logs
# Common issues:
# 1. Missing secrets in GitHub repository
# 2. Test failures
# 3. Build errors

# Required GitHub Secrets:
# - VERCEL_TOKEN
# - VERCEL_ORG_ID
# - VERCEL_PROJECT_ID
# - DATABASE_URL
```

---

## üìä PERFORMANCE ISSUES

### Slow Response Times

#### Issue: API Endpoints Slow
```
Response time > 2 seconds
```

**Solution:**
```bash
# Check database query performance
npx prisma studio

# Optimize queries
# Add database indexes
# Implement caching

# Check server resources
node scripts/performance-monitor.js
```

#### Issue: Video Loading Slow
```
Videos taking > 5 seconds to load
```

**Solution:**
```bash
# Check video file sizes
ls -la public/videos/

# Optimize video compression
# Configure CDN caching
# Implement progressive loading
```

### Memory Issues

#### Issue: High Memory Usage
```
Memory usage > 80%
```

**Solution:**
```bash
# Check memory usage
node scripts/performance-monitor.js

# Optimize memory usage:
# 1. Implement connection pooling
# 2. Cache frequently accessed data
# 3. Optimize video loading
# 4. Add memory monitoring
```

---

## üîç DEBUGGING TOOLS

### Server Debugging

#### Enable Debug Logging
```bash
# Set debug environment variable
export DEBUG=langflix:*

# Start server with debug logging
npm run start:server
```

#### Check Server Logs
```bash
# View server logs
tail -f logs/server.log

# Check error logs
grep -i error logs/server.log

# Monitor real-time logs
npm run start:server 2>&1 | tee logs/live.log
```

### Database Debugging

#### Prisma Studio
```bash
# Open database browser
npx prisma studio

# Check table data
# Verify relationships
# Monitor query performance
```

#### Database Logs
```bash
# Check database connection logs
npx prisma db push --verbose

# Monitor database queries
# Enable query logging in Prisma
```

---

## üõ†Ô∏è MAINTENANCE TASKS

### Regular Maintenance

#### Weekly Tasks
```bash
# Run security audit
./scripts/security-audit.sh

# Check for outdated dependencies
npm audit

# Update dependencies
npm update

# Clean up logs
find logs/ -name "*.log" -mtime +7 -delete
```

#### Monthly Tasks
```bash
# Review monitoring metrics
cat logs/performance.log | tail -100

# Check database performance
npx prisma studio

# Update API keys (if needed)
# Review security configurations
```

### Emergency Procedures

#### Server Down
```bash
# Check server status
curl http://localhost:3001/api/health

# Restart server
npm run start:server

# Check logs for errors
tail -f logs/server.log
```

#### Database Issues
```bash
# Test database connection
npx prisma db push

# Check database backups
ls -la backups/

# Restore from backup if needed
./scripts/restore-database.sh latest_backup.sql.gz
```

---

## üìû GETTING HELP

### Self-Service Resources
1. **Check logs first**: `tail -f logs/server.log`
2. **Run diagnostics**: `npm run setup:check`
3. **Check this guide**: Search for your specific error
4. **Review documentation**: `LANGFLIX_SOURCE.md`

### When to Escalate
- Database corruption
- Security breach
- Complete service outage
- Data loss

### Useful Commands
```bash
# Quick health check
npm run setup:check && curl http://localhost:3001/api/health

# Full system status
./scripts/setup-monitoring.sh && node scripts/performance-monitor.js

# Emergency restart
pkill -f "node server.js" && npm run start:server
```

---

**Remember**: Always backup data before making changes to production systems!
