<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ðŸ“– Stories - Learn Spanish Culture</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #000;
            color: #fff;
            overflow: hidden;
        }

        /* Story Container */
        .story-container {
            position: relative;
            width: 100vw;
            height: 100vh;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        /* Progress Bars */
        .progress-bars {
            position: absolute;
            top: 10px;
            left: 10px;
            right: 10px;
            display: flex;
            gap: 4px;
            z-index: 100;
        }

        .progress-bar {
            flex: 1;
            height: 3px;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 2px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: white;
            width: 0%;
            transition: width 0.1s linear;
        }

        .progress-fill.complete {
            width: 100%;
        }

        /* Story Content */
        .story-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
            padding: 40px;
            max-width: 90%;
        }

        .story-icon {
            font-size: 80px;
            margin-bottom: 20px;
            animation: bounce 2s infinite;
        }

        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        .story-title {
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 20px;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
        }

        .story-text {
            font-size: 20px;
            line-height: 1.6;
            margin-bottom: 15px;
            cursor: pointer;
        }

        .story-word {
            position: relative;
            border-bottom: 2px dotted rgba(255, 255, 255, 0.5);
            cursor: pointer;
            transition: all 0.2s;
        }

        .story-word:hover {
            border-bottom-color: white;
            transform: translateY(-2px);
        }

        .story-translation {
            font-size: 16px;
            opacity: 0.8;
            font-style: italic;
            display: none;
        }

        .story-translation.visible {
            display: block;
        }

        /* Navigation Areas */
        .nav-area {
            position: absolute;
            top: 0;
            bottom: 0;
            width: 50%;
            z-index: 50;
            cursor: pointer;
        }

        .nav-area.left {
            left: 0;
        }

        .nav-area.right {
            right: 0;
        }

        /* Story Counter */
        .story-counter {
            position: absolute;
            top: 30px;
            right: 20px;
            background: rgba(0, 0, 0, 0.5);
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 14px;
            z-index: 100;
        }

        /* Close Button */
        .close-button {
            position: absolute;
            top: 30px;
            left: 20px;
            background: rgba(0, 0, 0, 0.5);
            border: none;
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            font-size: 24px;
            cursor: pointer;
            z-index: 100;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* Audio Button */
        .audio-button {
            position: absolute;
            bottom: 100px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
            border: 2px solid white;
            color: white;
            padding: 15px 30px;
            border-radius: 30px;
            font-size: 18px;
            cursor: pointer;
            z-index: 100;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .audio-button:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        /* Bottom Nav */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(20px);
            padding: 15px;
            display: flex;
            justify-content: space-around;
            align-items: center;
            z-index: 1000;
        }

        .nav-item {
            color: white;
            text-decoration: none;
            font-size: 24px;
            opacity: 0.6;
            transition: opacity 0.2s;
        }

        .nav-item.active {
            opacity: 1;
            color: #667eea;
        }

        /* Translation Popup */
        .translation-popup {
            position: fixed;
            bottom: 150px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.95);
            padding: 20px 30px;
            border-radius: 15px;
            max-width: 90%;
            display: none;
            z-index: 1000;
        }

        .translation-popup.visible {
            display: block;
            animation: slideUp 0.3s ease;
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateX(-50%) translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateX(-50%) translateY(0);
            }
        }

        .popup-word {
            font-size: 24px;
            font-weight: 700;
            color: #667eea;
            margin-bottom: 10px;
        }

        .popup-translation {
            font-size: 18px;
            opacity: 0.9;
        }

        /* Mobile Optimization */
        @media (max-width: 600px) {
            .story-icon {
                font-size: 60px;
            }

            .story-title {
                font-size: 24px;
            }

            .story-text {
                font-size: 18px;
            }
        }
    </style>

    <!-- Sentry Error Tracking -->
    <meta name="sentry-dsn" content="">
    <meta name="sentry-environment" content="production">
    <meta name="sentry-traces-sample-rate" content="0.1">
    <meta name="app-version" content="1.0.0">
    <script src="/lib/sentry-client.js" defer></script>
</head>
<body>
    <!-- Story Container -->
    <div class="story-container" id="storyContainer">
        <!-- Progress Bars -->
        <div class="progress-bars" id="progressBars"></div>

        <!-- Close Button -->
        <button class="close-button" onclick="window.location.href='/tiktok-video-feed.html'">Ã—</button>

        <!-- Story Counter -->
        <div class="story-counter" id="storyCounter">1/30</div>

        <!-- Story Content -->
        <div class="story-content" id="storyContent">
            <!-- Content loaded dynamically -->
        </div>

        <!-- Audio Button -->
        <button class="audio-button" id="audioButton" onclick="playAudio()">
            ðŸ”Š Listen
        </button>

        <!-- Navigation Areas -->
        <div class="nav-area left" onclick="previousStory()"></div>
        <div class="nav-area right" onclick="nextStory()"></div>
    </div>

    <!-- Bottom Nav -->
    <div class="bottom-nav">
        <a href="/tiktok-video-feed.html" class="nav-item">ðŸŽ¬</a>
        <a href="/discover-ai.html" class="nav-item">ðŸ“°</a>
        <a href="/music-player.html" class="nav-item">ðŸŽµ</a>
        <a href="/stories.html" class="nav-item active">ðŸ“–</a>
        <a href="/profile.html" class="nav-item">ðŸ‘¤</a>
    </div>

    <!-- Translation Popup -->
    <div class="translation-popup" id="translationPopup">
        <div class="popup-word" id="popupWord"></div>
        <div class="popup-translation" id="popupTranslation"></div>
    </div>

    <script>
        // Stories data (will be loaded from stories.json in production)
        const stories = [
            {
                id: 1,
                icon: "ðŸŒ®",
                title: "Mexican Tacos",
                spanish: "Los tacos son parte fundamental de la cultura mexicana.",
                english: "Tacos are a fundamental part of Mexican culture.",
                level: "A2"
            },
            {
                id: 2,
                icon: "ðŸ’ƒ",
                title: "Flamenco Dance",
                spanish: "El flamenco es un arte tradicional de EspaÃ±a que combina mÃºsica y baile.",
                english: "Flamenco is a traditional art from Spain that combines music and dance.",
                level: "B1"
            },
            {
                id: 3,
                icon: "ðŸ–ï¸",
                title: "Beach Culture",
                spanish: "Las playas de AmÃ©rica Latina son famosas por su belleza natural.",
                english: "The beaches of Latin America are famous for their natural beauty.",
                level: "A2"
            },
            {
                id: 4,
                icon: "âš½",
                title: "FÃºtbol Passion",
                spanish: "El fÃºtbol es el deporte mÃ¡s popular en EspaÃ±a y LatinoamÃ©rica.",
                english: "Soccer is the most popular sport in Spain and Latin America.",
                level: "A2"
            },
            {
                id: 5,
                icon: "ðŸŽ­",
                title: "DÃ­a de los Muertos",
                spanish: "El DÃ­a de los Muertos es una celebraciÃ³n mexicana para honrar a los difuntos.",
                english: "Day of the Dead is a Mexican celebration to honor the deceased.",
                level: "B1"
            },
            {
                id: 6,
                icon: "ðŸ·",
                title: "Spanish Wine",
                spanish: "EspaÃ±a produce algunos de los mejores vinos del mundo.",
                english: "Spain produces some of the best wines in the world.",
                level: "B1"
            },
            {
                id: 7,
                icon: "ðŸŒ¶ï¸",
                title: "Spicy Food",
                spanish: "La comida picante es muy comÃºn en la cocina mexicana.",
                english: "Spicy food is very common in Mexican cuisine.",
                level: "A2"
            },
            {
                id: 8,
                icon: "ðŸŽ¨",
                title: "Frida Kahlo",
                spanish: "Frida Kahlo es una de las artistas mÃ¡s reconocidas de MÃ©xico.",
                english: "Frida Kahlo is one of the most recognized artists from Mexico.",
                level: "B2"
            },
            {
                id: 9,
                icon: "ðŸ›ï¸",
                title: "Machu Picchu",
                spanish: "Machu Picchu es una antigua ciudad inca en PerÃº.",
                english: "Machu Picchu is an ancient Inca city in Peru.",
                level: "B1"
            },
            {
                id: 10,
                icon: "ðŸŽ¸",
                title: "Mariachi Music",
                spanish: "Los mariachis son mÃºsicos tradicionales de MÃ©xico que tocan en celebraciones.",
                english: "Mariachis are traditional Mexican musicians who play at celebrations.",
                level: "B1"
            }
        ];

        let currentStoryIndex = 0;
        let storyTimer = null;
        let showingTranslation = false;

        // Initialize
        function init() {
            generateProgressBars();
            loadStory(0);
            startAutoAdvance();
        }

        // Generate progress bars
        function generateProgressBars() {
            const container = document.getElementById('progressBars');
            container.innerHTML = stories.map((_, index) => `
                <div class="progress-bar">
                    <div class="progress-fill" id="progress-${index}"></div>
                </div>
            `).join('');
        }

        // Load story
        function loadStory(index) {
            if (index < 0 || index >= stories.length) return;

            currentStoryIndex = index;
            const story = stories[index];
            showingTranslation = false;

            // Update story counter
            document.getElementById('storyCounter').textContent = `${index + 1}/${stories.length}`;

            // Update content
            const container = document.getElementById('storyContent');
            container.innerHTML = `
                <div class="story-icon">${story.icon}</div>
                <div class="story-title">${story.title}</div>
                <div class="story-text" onclick="toggleTranslation()">
                    ${highlightWords(story.spanish)}
                </div>
                <div class="story-translation ${showingTranslation ? 'visible' : ''}" id="translationText">
                    ${story.english}
                </div>
            `;

            // Update progress
            updateProgress();

            // Reset and start timer
            resetTimer();
            startAutoAdvance();
        }

        // Highlight clickable words
        function highlightWords(text) {
            return text.split(' ').map(word => 
                `<span class="story-word" onclick="showWordTranslation('${word}', event)">${word}</span>`
            ).join(' ');
        }

        // Toggle translation
        function toggleTranslation() {
            showingTranslation = !showingTranslation;
            const translationEl = document.getElementById('translationText');
            if (translationEl) {
                translationEl.classList.toggle('visible');
            }
        }

        // Show word translation
        async function showWordTranslation(word, event) {
            event.stopPropagation();
            
            const popup = document.getElementById('translationPopup');
            document.getElementById('popupWord').textContent = word;
            document.getElementById('popupTranslation').textContent = 'Loading...';
            popup.classList.add('visible');

            // Simulate translation API
            setTimeout(() => {
                const translations = {
                    'tacos': 'tacos',
                    'cultura': 'culture',
                    'mexicana': 'Mexican',
                    'flamenco': 'flamenco',
                    'mÃºsica': 'music',
                    'baile': 'dance',
                    'playas': 'beaches',
                    'belleza': 'beauty',
                    'fÃºtbol': 'soccer',
                    'deporte': 'sport'
                };

                const translation = translations[word.replace(/[.,!?]/g, '').toLowerCase()] || 'Translation not found';
                document.getElementById('popupTranslation').textContent = translation;

                setTimeout(() => {
                    popup.classList.remove('visible');
                }, 3000);
            }, 300);

            // Save word to vocabulary
            saveWord(word);
        }

        // Save word to vocabulary
        async function saveWord(word) {
            console.log('Saving word to vocabulary:', word);
            // Implementation will connect to vocabulary API
        }

        // Update progress bars
        function updateProgress() {
            stories.forEach((_, index) => {
                const progressEl = document.getElementById(`progress-${index}`);
                if (index < currentStoryIndex) {
                    progressEl.classList.add('complete');
                } else if (index === currentStoryIndex) {
                    progressEl.classList.remove('complete');
                    progressEl.style.width = '0%';
                } else {
                    progressEl.classList.remove('complete');
                    progressEl.style.width = '0%';
                }
            });
        }

        // Start auto-advance timer
        function startAutoAdvance() {
            const duration = 5000; // 5 seconds per story
            const interval = 100;
            let elapsed = 0;

            resetTimer();

            storyTimer = setInterval(() => {
                elapsed += interval;
                const progress = (elapsed / duration) * 100;
                
                const currentProgress = document.getElementById(`progress-${currentStoryIndex}`);
                if (currentProgress) {
                    currentProgress.style.width = progress + '%';
                }

                if (elapsed >= duration) {
                    nextStory();
                }
            }, interval);
        }

        // Reset timer
        function resetTimer() {
            if (storyTimer) {
                clearInterval(storyTimer);
                storyTimer = null;
            }
        }

        // Next story
        function nextStory() {
            if (currentStoryIndex < stories.length - 1) {
                loadStory(currentStoryIndex + 1);
            } else {
                // Loop back to start or exit
                window.location.href = '/tiktok-video-feed.html';
            }
        }

        // Previous story
        function previousStory() {
            if (currentStoryIndex > 0) {
                loadStory(currentStoryIndex - 1);
            }
        }

        // Play audio
        function playAudio() {
            const story = stories[currentStoryIndex];
            const utterance = new SpeechSynthesisUtterance(story.spanish);
            utterance.lang = 'es-ES';
            utterance.rate = 0.9;
            speechSynthesis.speak(utterance);
        }

        // Keyboard shortcuts
        document.addEventListener('keydown', (e) => {
            if (e.key === 'ArrowLeft') {
                previousStory();
            } else if (e.key === 'ArrowRight') {
                nextStory();
            } else if (e.key === ' ') {
                e.preventDefault();
                toggleTranslation();
            }
        });

        // Initialize on load
        init();
    </script>
</body>
</html>
