<!-- ðŸš€ COMPLETE APP INTEGRATION - Priority 1 Features -->
<!-- Add this snippet to <head>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="dns-prefetch" href="https://fonts.googleapis.com"> of tiktok-video-feed.html before 
    <!-- Sentry Error Tracking -->
    <meta name="sentry-dsn" content="">
    <meta name="sentry-environment" content="production">
    <meta name="sentry-traces-sample-rate" content="0.1">
    <meta name="app-version" content="1.0.0">
    <script>
    // Load Sentry AFTER page is fully interactive
    window.addEventListener('load', function() {
        setTimeout(function() {
            var script = document.createElement('script');
            script.src = '/lib/sentry-client.js';
            script.defer = true;
            document.head.appendChild(script);
        }, 2000); // Load 2 seconds after page load
    });
    </script>
</head> -->

<!-- Confetti Library -->
<script src="/lib/confetti.min.js"></script>

<!-- Achievement System Styles -->
<link rel="stylesheet" href="/css/achievements-gamification.css">
<link rel="stylesheet" href="/css/onboarding.css">

<!-- Core Systems -->
<script src="/lib/achievement-system.js"></script>
<script src="/lib/onboarding-system.js"></script>
<script src="/lib/app-complete-integration.js"></script>

<style>
/* Additional quick-fix styles for complete app */

/* Ensure progress cards are visible */
.progress-summary {
    padding-top: calc(env(safe-area-inset-top, 0px) + 20px);
}

/* Video Controls Container */
.video-controls-enhanced button:hover {
    transform: scale(1.1);
    border-color: #00F5FF !important;
}

.video-controls-enhanced button:active {
    transform: scale(0.95);
}

/* Ensure touch targets are 44px minimum */
.video-controls-enhanced button,
.help-button,
.onboarding-action,
button {
    min-width: 44px;
    min-height: 44px;
}

/* Pull to refresh indicator */
.pull-to-refresh-indicator {
    position: fixed;
    top: calc(env(safe-area-inset-top, 0px) + 10px);
    left: 50%;
    transform: translateX(-50%);
    background: rgba(0, 0, 0, 0.8);
    color: #00F5FF;
    padding: 10px 20px;
    border-radius: 20px;
    font-size: 14px;
    z-index: 9999;
    opacity: 0;
    transition: opacity 0.3s;
    pointer-events: none;
}

.pull-to-refresh-indicator.visible {
    opacity: 1;
}

/* Success celebration overlay */
.success-celebration {
    position: fixed;
    top: 0;
    left: 0;
    width: 100vw;
    height: 100vh;
    z-index: 9998;
    pointer-events: none;
}

/* Level up animation */
@keyframes levelUp {
    0% {
        transform: scale(0) rotate(-180deg);
        opacity: 0;
    }
    50% {
        transform: scale(1.2) rotate(10deg);
        opacity: 1;
    }
    100% {
        transform: scale(1) rotate(0deg);
        opacity: 1;
    }
}

.level-up-animation {
    animation: levelUp 0.8s cubic-bezier(0.68, -0.55, 0.265, 1.55);
}
</style>

<script>
// Initialize pull-to-refresh
(function() {
    let startY = 0;
    let pullDistance = 0;
    const threshold = 80;
    let isPulling = false;

    const indicator = document.createElement('div');
    indicator.className = 'pull-to-refresh-indicator';
    indicator.textContent = 'â†“ Pull to refresh';
    document.body.appendChild(indicator);

    document.addEventListener('touchstart', (e) => {
        const scrollTop = document.querySelector('.feed-container')?.scrollTop || 0;
        if (scrollTop === 0) {
            startY = e.touches[0].pageY;
            isPulling = true;
        }
    });

    document.addEventListener('touchmove', (e) => {
        if (!isPulling) return;

        pullDistance = e.touches[0].pageY - startY;

        if (pullDistance > 0) {
            indicator.style.opacity = Math.min(pullDistance / threshold, 1);
            if (pullDistance > threshold) {
                indicator.textContent = 'â†‘ Release to refresh';
                indicator.style.color = '#00AACC';
            } else {
                indicator.textContent = 'â†“ Pull to refresh';
                indicator.style.color = '#00F5FF';
            }
        }
    });

    document.addEventListener('touchend', () => {
        if (pullDistance > threshold) {
            indicator.textContent = 'âŸ³ Refreshing...';
            setTimeout(() => {
                location.reload();
            }, 500);
        } else {
            indicator.style.opacity = 0;
        }
        isPulling = false;
        pullDistance = 0;
    });
})();

// Dispatch custom events for video completions
// Hook into existing video event listeners
document.addEventListener('DOMContentLoaded', () => {
    // Observe video ended events
    setInterval(() => {
        const videos = document.querySelectorAll('video');
        videos.forEach(video => {
            if (!video.dataset.endListenerAdded) {
                video.addEventListener('ended', () => {
                    const event = new CustomEvent('video-completed', {
                        detail: { videoId: video.dataset.videoId || video.src }
                    });
                    document.dispatchEvent(event);
                });
                video.dataset.endListenerAdded = 'true';
            }

            // Track when video reaches 80% (considered "viewed")
            if (!video.dataset.viewListenerAdded) {
                video.addEventListener('timeupdate', function() {
                    if (this.currentTime / this.duration > 0.8 && !this.dataset.viewedTriggered) {
                        const event = new CustomEvent('video-viewed', {
                            detail: { videoId: this.dataset.videoId || this.src }
                        });
                        document.dispatchEvent(event);
                        this.dataset.viewedTriggered = 'true';
                    }
                });
                video.dataset.viewListenerAdded = 'true';
            }
        });
    }, 2000); // Check every 2 seconds for new videos
});

// Listen for word clicks (hook into existing translation popups)
document.addEventListener('click', (e) => {
    // Check if clicked on a Spanish word
    if (e.target.classList.contains('spanish-word') ||
        e.target.classList.contains('word') ||
        e.target.closest('.word-translation')) {

        const word = e.target.textContent || e.target.dataset.word;
        if (word) {
            const event = new CustomEvent('word-clicked', {
                detail: { word: word.trim() }
            });
            document.dispatchEvent(event);
        }
    }
}, true);

console.log('âœ… Complete app integration snippet loaded');
</script>
